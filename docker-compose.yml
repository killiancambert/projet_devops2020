version: "3"

services:
  db :
    container_name: db
    image: mysql
    environment:
      MYSQL_DATABASE: "devops"
      MYSQL_USER: "root"
      MYSQL_PASSWORD: "root"
      MYSQL_ROOT_PASSWORD: "root"
    ports:
      - "3309:3306"
    volumes:
      - ./devops_dump.sql:/docker-entrypoint-initdb.d/dump.sql

  unite_1:
    container_name: unite_1
    build: ./automate
    environment:
      - UNITE=1
    command: >
      bash -c '
      python generation.py &
      python envoie.py'


  unite_2:
    container_name: unite_2
    build: ./automate
    environment:
      - UNITE=2
    command: >
      bash -c '
      python generation.py &
      python envoie.py'

  unite_3:
    container_name: unite_3
    build: ./automate
    environment:
      - UNITE=3
    command: >
      bash -c '
      python generation.py &
      python envoie.py'

  unite_4:
    container_name: unite_4
    build: ./automate
    environment:
      - UNITE=4
    command: >
      bash -c '
      python generation.py &
      python envoie.py'

  unite_5:
    container_name: unite_5
    build: ./automate
    environment:
      - UNITE=5
    command: >
      bash -c '
      python generation.py &
      python envoie.py'
      
  recup_donnees:
    container_name: recup_donnees
    build: ./recup_donnees/
    ports:
      - "127.0.0.1:5000:5000"
    command: >
      bash -c '
      python script.py'
      - "5000:5000"

  index:
    container_name: index
    build: ./index/
    ports:
      - '80:80'
